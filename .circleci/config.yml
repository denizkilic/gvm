# Golang CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-go/ for more details
version: 2

linuxGoEnv1_14: &linuxGoEnv1_14
  docker:
    - image: golang:1.14
  environment:
    GOROOT: /usr/local/go
  working_directory: /go/src/github.com/olimpias/gvm

linuxGoEnv1_10: &linuxGoEnv1_10
  docker:
    - image: golang:1.10
  environment:
    GOROOT: /usr/local/go
  working_directory: /go/src/github.com/olimpias/gvm

jobs:
  unit-tests:
    <<: *linuxGoEnv1_14
    steps:
      - checkout
      # specify any bash command here prefixed with `run: `
      - run: go get -v -t -d ./...
      - run: go test -v ./...

  integration-test-linux:
    <<: *linuxGoEnv1_10
    steps:
      - checkout
      - run:
          command: |
            go get ./...
            go build -o gvm ./cmd
            ./gvm dl 1.14.4
            ./gvm use 1.14.4
            go version
            [[ $(go version) == "go version go1.14.4 linux/amd64" ]] && exit 0 || exit 1

  integration-test-windows:
    machine:
      image: windows-default # Windows machine image
    resource_class: windows.medium
    steps:
      # Commands are run in a Windows virtual machine environment
      - checkout
      - run: echo $GOROOT
      - run: go version
      - run: Write-Host 'Hello, Windows'

workflows:
  version: 2
  all:
    jobs:
      - unit-tests
      - integration-test-linux

